- name: Setup sudo
  hosts: servers
  become: true
  vars:
    users: # Add future sudo users to this list
      - glade
  tasks:
    - name: Install sudo
      apt:
        name: sudo
        state: present

    - name: Ensure 'devs' group exists
      group:
        name: devs
        state: present

    - name: Add group 'devs' to sudoers
      lineinfile:
        dest: /etc/sudoers
        state: present
        regexp: "^%devs"
        line: "%devs ALL=(ALL:ALL) ALL "
        validate: "visudo -cf %s"

    - name: Add sudoers users to devs group
      user:
        name: "{{ item }}"
        groups: devs
        append: true
        state: present
        createhome: true
      with_items: "{{ users }}"

- name: Setup Git
  hosts: servers
  become: true
  tasks:
    - name: Install Git
      apt:
        name: git
        state: present

    - name: Setup git user
      community.general.git_config:
        name: user.name
        scope: global
        value: glade

    - name: Setup git email
      community.general.git_config:
        name: user.email
        scope: global
        value: owloftheglade@gmail.com

- name: Setup Docker
  hosts: servers
  become: true
  tasks:
    - name: Install aptitude
      apt:
        name: aptitude
        state: latest
        update_cache: true

    - name: Install required system packages
      apt:
        pkg:
          - apt-transport-https
          - ca-certificates
          - curl
          - software-properties-common
          - python3-pip
          - virtualenv
          - python3-setuptools
        state: latest
        update_cache: true

    - name: Add Docker GPG apt key
      apt_key:
        url: "https://download.docker.com/linux/{{ ansible_distribution | lower }}/gpg"
        state: present

    - name: Add Docker Repository
      apt_repository:
        repo: "deb [arch={{ ansible_architecture }}] https://download.docker.com/linux/{{ ansible_distribution | lower }} {{ ansible_distribution_release }} stable"
        state: present
        filename: docker

    - name: Install Docker
      apt:
        name:
          - docker
          - docker.io
          - docker-compose
          - docker-registry
        state: latest
        update_cache: true
